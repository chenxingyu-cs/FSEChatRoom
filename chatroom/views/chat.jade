extends layout

block content
  h1= title 
  p Welcome to #{title} #{username}
  div
    ul(id="messages")
    form(action="" id="chatform")
      input(id="chatmessages", autocomplete="off")
      button Send

  script(type='text/javascript').
    var userName =  !{JSON.stringify(username)};
    alert(userName);
    var socket = io();
    window.onload = newUser();

    function newUser()
    {
      socket.emit('new user in');
    }
    socket.on('chat message', function(data){
      var text = data.userName + ': ' + data.msgContent + '        ' + data.msgTime;
      $('#messages').append($('<li>').text(text)); 
    });

    $('#chatform').submit(function(){
      socket.emit('chat message', {
        userName: userName,
        msgContent: $('#chatmessages').val()
      });
      $('#chatmessages').val('');
      return false;
    });



